### 小提示

golang官方的gopls功能丰富，以至于golang代码风格基本上不需要考虑类似于缩进之类的格式问题

* 能够根据上下文提供智能的代码补全建议，这大大提高了编码效率。
* 能够根据Go语言的官方规范自动格式化代码，确保代码风格的一致性。
* 包含静态分析工具，能够检测代码中的潜在问题，如未使用的变量、类型错误等。
* 将鼠标放在某个变量或函数上时，gopls能够显示相关的文档信息，帮助开发者更好地理解代码。
* 提供代码导航功能，如跳转到定义、查找引用等，方便开发者在大型项目中快速定位代码。
* 支持代码重构操作，如重命名变量、函数等，确保重构后的代码仍然保持正确的功能和风格。


### 一、代码格式化

1. **代码风格**：代码必须格式化，可以使用gofmt或goimports等工具。最好统一成一种工具，防止不同开发人员使用不同工具提交代码时产生无意义的差异。原则上遵循goimports规范，它会自动把依赖按首字母排序，并对包进行分组管理，通过空行隔开，默认分为本地包（标准库、内部包）、第三方包。
2. **括号和空格**：运算符和操作数之间要留空格；作为输入参数或者数组下标时，运算符和运算数之间不需要空格。

### 二、包导入与管理

1. **导入包**：仅导入所有必需的包，并且按照分组标准库包、第三方包和私有包的格式整理导入部分。例如，使用goimports会自动整理包的导入。
2. **依赖管理**：go1.11以上版本建议使用go modules模式进行依赖管理，不提交vendor目录，但将go.sum文件添加到版本控制中。

### 三、命名规范

1. **包命名**：保持package名字和目录一致，尽量采用有意义、简短的包名，不要与标准库冲突。包名应该为小写单词，不要使用下划线或者混合大小写，可以使用多级目录来划分层级。
2. **文件命名**：文件名应该采用小写，并且使用下划线分割各个单词，文件名尽量采用有意义的简短词汇。
3. **结构体、接口、变量、常量、函数命名**：

	* 结构体和接口名采用驼峰命名方式，首字母根据访问控制采用大写或者小写（需要导出为大写，不需要导出为小写）。
	* 变量名、常量名、函数名也采用驼峰命名法，首字母根据访问控制决定使用大写或者小写。
	* 特定命名规则，如bool类型的变量名应以Has、Is、Can或Allow开头
        * 特别的，对于涉及数据库的访问函数，命名应遵循数据库操作而不是业务操作，比如通过YYY查询XXX是否存在，函数命名应当为`QueryXXXExistByYYY(YYY) (bool, error)`

### 四、代码结构与可读性

1. **注释**：

	* 尽量在编码阶段同步写好变量、函数、包的注释，注释可以通过godoc导出生成文档。
	* 程序中每个被导出的（大写的）名字，都应该有一个文档注释。
	* 注释应放在所注释内容的前一行或附近位置。

2. **控制结构**：

	* 使用适当的缩进，一致使用制表符或者空格（最好使用制表符），按照Go的标准约定进行缩进。
	* 避免使用goto语句，除非在特定的框架或底层源码中。
	* 嵌套深度不能超过4层，以提高代码的可读性。

3. **魔法数字**：如果魔法数字在代码中出现超过两次，则应该定义常量来代替，以提高代码的可维护性。

### 五、错误处理

1. **error处理**：

	* 当error作为函数的值返回时，必须对error进行处理，或将返回值赋值给明确忽略的变量。
	* 如果函数有多个返回值，并且其中一个是error类型，则error必须是最后一个参数。
	* 优先处理错误，能return尽早return。
	* 错误返回的判断应独立处理，不与其他变量组合逻辑判断。
    * 特别的，在本次实践中，实现类似于java的错误栈解操作，应当遵循以下返回格式：
        * 起始err作为error类型返回，不进行任何装饰
        * 调用函数获得被调用函数的err包装为Errno，并隐式返回（显式返回error）

2. **panic与recover**：

	* 在main包中，只有当遇到完全不可运行的情况（如文件无法打开、数据库无法连接等）时，才可使用panic。
	* 建议在main包中使用log.Fatal来记录错误，这样可以通过log来结束程序，或者将panic抛出的异常记录到日志文件中，方便排查问题。（本次实践应当使用hlog包）
	* panic捕获只能到goroutine的最顶层，每个自行启动的goroutine必须在入口处捕获panic，并打印堆栈信息或进行其他处理。
	* recover用于捕获runtime的异常，禁止滥用recover。recover必须在defer中使用，一般用于捕获程序运行期间发生异常抛出的panic或程序主动抛出的panic。

### 六、其他规范

1. **单元测试**：

	* 单元测试文件名命名规范为example_test.go。
	* 测试用例的函数名称必须以Test开头，例如TestExample。
	* 每个重要的可导出函数都要首先编写测试用例，测试用例和正规代码一起提交，方便进行回归测试。

2. **变量声明**：变量声明尽量放在变量第一次使用前面，遵循就近原则。
3. **defer使用**：当存在资源管理时，应紧跟defer函数进行资源释放。判断是否有错误发生之后，再defer释放资源。禁止在循环中使用defer。
4. **函数参数**：函数的返回相同类型的两个或三个参数，或者从上下文不清楚结果的含义时，使用命名返回，其他情况不建议使用命名返回。传入变量和返回变量以小写字母开头，参数数量建议不要超过5个。尽量使用值传递，非指针传递；但传入参数是map、slice、chan、interface时，不要传递指针。

### 七、工具使用

1. **gofmt**：大部分的格式问题可以通过gofmt解决。gofmt可以自动格式化代码，保证所有的Go代码与官方推荐的格式保持一致。
2. **go vet**：vet工具可以静态分析源码中存在的各种问题，例如多余的代码、提前return的逻辑、struct的tag是否符合标准等。建议在编译前执行代码静态分析。
3. **golint**：检测代码中不规范的地方，帮助开发者写出更符合Golang规范的代码。